<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="Generator" content="EditPlus®">
  <meta name="Author" content="">
  <meta name="Keywords" content="">
  <meta name="Description" content="">
  <link href="../../maychangecss/newblog_nomal.css" type="text/css" rel="stylesheet">
  <title>【LODOP】获取打印任务的页数（预览或打印后获取）（newblog122）（文案，初）</title>
 </head>
 <body>
 <style>
 body{margin:0px;}
.body {width:100%;}
a{text-decoration:none;color:black;}
h1{font-size:1.625em;}
h2{font-size:1.375em;}
/**.box{float:left;}**/
.header_box {width:100%;}
.header{padding:1%;
background-color:#f1f1f1;}
/**border:1px solid #e9e9e9;}**/

.header_bottom{width:100%;}
.menuitem {
    margin-top:0;
    margin-left:0;
    margin-bottom:0;
    padding:1%;
    border-bottom:1px solid #e9e9e9;
    cursor:pointer;
}

.main {padding:1%;}
.main_middle { width:100%;}
.blue{color:#95bfc7;}


.box_footer {width:100%;margin-bottom:0;}
.footer {
    padding:1%;
    text-align:center;
    background-color:#f1f1f1;
    font-size:0.625em;
}

@media only screen and (max-width: 500px) {
    .menu_left{width:100%;}
    .menuitem { margin:1%;padding:1%;}

    .main_middle { width:100%;}
    .main {padding:1%;}

    .box_right {width:100%;}
    .right { padding:1%;
    }

    .box { margin-right:0; float:left; }
}

</style>
<div class="body"><!--body开始-->
        <div class="box header_box"><!--header开始-->
            <div class="header">
                <h1>博文-【LODOP】获取打印任务的页数（预览或打印后获取）（newblog122）（文案，初）</h1>
            </div>
        </div><!--header结束-->
<div class="header_bottom"> 
		   <a href="../../index.html"><div class="menuitem">花谢悦神的主页</div></a>	
		   <a href="../phoneQA004.html"><div class="menuitem">lodop问答主页</div></a> 
		   <a href="../phoneQA_dange.html"><div class="menuitem">问答主页（单个问答链接）</div></a> 
		   <a href="../mini_QAs.html"><div class="menuitem"><span style="color:#ff0099;">迷你一个问答</span></div></a> 
		   <a href="../new_bloglist.html"><div class="menuitem"><span class="newblogfont">新博文newblogs</span></div></a>
</div>
        <div class="box main_middle"><!--main_middle开始-->
            <div class="main">
<h1>【LODOP】获取打印任务的页数（预览或打印后获取）（newblog122）（文案，初）</h1>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p>如何获取当前打印任务的页数？<br />打印预览或打印后可以获取，参考样例22，http://www.c-lodop.com/demolist/PrintSample22.html</p>
<p>预览或打印前可以获取吗，预览或打印前就想知道该任务有几页？<br />不支持，必须是预览或打印后获取，<br />如果是自动分页，预览或打印前无法知道该任务分了多少页。<br />如果是手动分页，每页固定内容，无自动分页情况，页数是自己控制的，可以自己输出自己设置的页数。</p>
<p>样例22是内嵌的，不内嵌可以获取吗？<br />可以，截止视频发布时间，这个样例22是新版的，旧版的是c-lodop弹出预览窗口，lodop插件内嵌的。<br />（由于lodop插件方式目前只有IE等浏览器支持，且插件不再更新了，目前大都是c-lodop，这里不在介绍插件的相关介绍）</p>
<p>这里写个例子演示下：<br />（只用c-lodop情况下，如果是混合部署，加判断if (LODOP.CVERSION)判断为c-lodop走回调，else走直接返回）</p>
<p>注意：只有预览或打印后才能返回，如果之前没有执行预览或打印，是没有值的。<br />先执行打印预览，再执行获取页数，分成两个任务执行<br />（图）</p>
<p>&lt;a href="javascript:prn1_preview()"&gt;打印预览&lt;/a&gt;&lt;br&gt;<br />&lt;p&gt;  <br />&lt;input type="button" value="该任务的总页数:" onclick="javascript:prn1_get()"&gt;     <br />  &lt;input type="text" id="S11" size="20"&gt;（执行打印或预览指令后才正确）         <br />&lt;/p&gt;</p>
<p>JS代码：<br />（图）<br />（图）<br />（这里只写了回调，只用c-lodop情况下）</p>
<p>表格直接复制的样例2的表格，根据htm根据打印项高度自动分页的特点，减小高度，分了3页：<br />function prn1_preview() {	<br />		LODOP=getLodop();  <br />		LODOP.PRINT_INIT("打印控件功能演示_Lodop功能_表单一");<br />                LODOP.ADD_PRINT_HTM(20,27,300,40,"省略htm表格");<br />		LODOP.PREVIEW();	<br />	};<br />function prn1_get() {//只用c-ldoop情况下<br />        LODOP=getLodop(); <br />        LODOP.On_Return=function(TaskID,Value){document.getElementById("S11").value=Value}; <br />        LODOP.GET_VALUE("PRINTSETUP_PAGE_COUNT","0");//获取该任务全部页数<br />    };</p>
<p><br />不内嵌情况下，c-lodop本地预览窗口会是弹出形式，可以看到当前页数是3。<br />（图）</p>
<p>关闭预览后，可以得到当前任务的结果：<br />（图）</p>
<p>（特别注意：必须先预览或打印后，才可以获取到，否则是空的）</p>
<p>直接打印后也可以获取到总页数吗？<br />是可以的，打印或预览后可以获取。</p>
<p>这里再改一下前面的代码，强制分页LODOP.NEWPAGEA();多加了一个自动分了三页的，共6页。<br />把预览替换成直接打印，并加了一个指定打印机语句：<br />LODOP.SET_PRINTER_INDEX("Microsoft XPS Document Writer");<br />LODOP.PRINT();<br />（图）（图）</p>
<p>查看指定的xps虚拟打印机的输出效果，是6页：<br />（图）</p>
<p>查看下直接打印后，再获取的该任务的页数，是6页：<br />（图）</p>
<p>是否有打印或预览前返回页数的方法，打印前想知道页数？<br />没有，必须预览或打印后获取，或先弄一个只预览不打印的预览，让客户先预览下，不点预览的打印，可以返回页数。<br />再根据页数决定是否打印。</p>
</div>
</div>
<p>&nbsp;</p>
</div>
<p>&nbsp;</p>
</div>
</div>
    </div><!--main_middle结束-->

        <div class="box box_footer"><!--box_footer开始-->
            <div class="footer">
<p>lodop简短问答页面.</p>
            </div>
        </div><!--box_footer结束-->
</div><!--body结束-->
 </body>
</html>
